{"mappings":"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","sources":["public/js/index.js","public/js/login.js","public/js/alerts.js","public/js/appMap.js","public/js/updateSettings.js","public/js/stripe.js"],"sourcesContent":["import { login, logout } from \"./login\";\r\nimport { displayMap } from \"./appMap\";\r\nimport { updateSettings } from \"./updateSettings\";\r\nimport { bookTour } from \"./stripe\";\r\n\r\nconst map = document.querySelector(\"#map\");\r\nconst loginForm = document.querySelector(\".form--login\");\r\nconst userPaswordForm = document.querySelector(\".form-user-password\");\r\nconst userDataForm = document.querySelector(\".form-user-data\");\r\n\r\nconst bookBtn = document.querySelector(\"#book-tour\");\r\n\r\nif (bookBtn) {\r\n   bookBtn.addEventListener(\"click\", (e) => {\r\n      const { tourId } = e.target.dataset;\r\n      e.target.textContent = \"Processing...\";\r\n      bookTour(tourId);\r\n   });\r\n}\r\n\r\nif (map) {\r\n   const locations = JSON.parse(map.dataset.locations);\r\n   displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n   const email = document.getElementById(\"email\");\r\n   const password = document.getElementById(\"password\");\r\n\r\n   loginForm.addEventListener(\"submit\", (e) => {\r\n      e.preventDefault();\r\n      login(email.value, password.value);\r\n   });\r\n}\r\n\r\nconst logoutButton = document.querySelector(\".nav__el--logout\");\r\nif (logoutButton) logoutButton.addEventListener(\"click\", logout);\r\n\r\nif (userDataForm)\r\n   userDataForm.addEventListener(\"submit\", (e) => {\r\n      e.preventDefault();\r\n\r\n      const form = new FormData();\r\n\r\n      form.append(\"name\", document.getElementById(\"name\").value);\r\n      form.append(\"email\", document.getElementById(\"email\").value);\r\n      form.append(\"photo\", document.getElementById(\"photo\").files[0]);\r\n\r\n      updateSettings(form, \"data\");\r\n   });\r\n\r\nif (userPaswordForm)\r\n   userPaswordForm.addEventListener(\"submit\", async (e) => {\r\n      e.preventDefault();\r\n\r\n      document.querySelector(\".btn--save-password\").textContent = \"UPDATING...\";\r\n\r\n      const passwordCurrent = document.getElementById(\"password-current\").value;\r\n      const password = document.getElementById(\"password\").value;\r\n      const passwordConfirmation = document.getElementById(\"password-confirm\").value;\r\n\r\n      await updateSettings({ passwordCurrent, password, passwordConfirmation }, \"password\");\r\n\r\n      document.getElementById(\"password-current\").value = \"\";\r\n      document.getElementById(\"password\").value = \"\";\r\n      document.getElementById(\"password-confirm\").value = \"\";\r\n\r\n      document.querySelector(\".btn--save-password\").textContent = \"SAVE PASSWORD\";\r\n   });\r\n","import { showAlert } from \"./alerts\";\r\n\r\nexport const login = (email, password) => {\r\n   const apiParams = {\r\n      method: \"POST\",\r\n      url: `http://127.0.0.1:3000/api/v1/users/login`,\r\n      data: {\r\n         email: email,\r\n         password: password,\r\n      },\r\n   };\r\n\r\n   const timeout = function (timer) {\r\n      return new Promise((resolve, reject) => {\r\n         setTimeout(() => {\r\n            reject(new Error(\"Server took to long to respond!\"));\r\n         }, timer * 1000);\r\n      });\r\n   };\r\n\r\n   const sendDataToAPI = async function (params) {\r\n      try {\r\n         const postData = axios.request(params);\r\n         const response = await Promise.race([postData, timeout(10)]);\r\n         if (response.statusText !== \"OK\") throw new Error(\"Something went wrong!\");\r\n\r\n         if (response.data.status === \"success\") {\r\n            showAlert(\"success\", \"Logged in successfully!\");\r\n\r\n            window.setTimeout(() => {\r\n               location.assign(\"/\");\r\n            }, 1500);\r\n         }\r\n         return response;\r\n      } catch (err) {\r\n         showAlert(\"error\", err.response.data.message);\r\n      }\r\n   };\r\n\r\n   sendDataToAPI(apiParams);\r\n};\r\n\r\nexport const logout = async () => {\r\n   const apiParams = {\r\n      method: \"GET\",\r\n      url: `http://127.0.0.1:3000/api/v1/users/logout`,\r\n   };\r\n\r\n   const timeout = function (timer) {\r\n      return new Promise((resolve, reject) => {\r\n         setTimeout(() => {\r\n            reject(new Error(\"Server took to long to respond!\"));\r\n         }, timer * 1000);\r\n      });\r\n   };\r\n   try {\r\n      const getData = axios.request(apiParams);\r\n      const response = await Promise.race([getData, timeout(10)]);\r\n\r\n      if (response.statusText !== \"OK\") throw new Error(\"Something went wrong! Please try again\");\r\n\r\n      if (response.data.status === \"success\") location.reload(true);\r\n   } catch (err) {\r\n      showAlert(\"error\", err);\r\n   }\r\n};\r\n","export const hideAlert = () => {\r\n   const el = document.querySelector(\".alert\");\r\n   if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\nexport const showAlert = (type, msg) => {\r\n   hideAlert();\r\n   const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n   document.querySelector(\"body\").insertAdjacentHTML(\"afterbegin\", markup);\r\n   setTimeout(hideAlert, 5000);\r\n};\r\n","export const displayMap = function (locations) {\r\n   const locationsArr = locations.map((location) => {\r\n      return location.coordinates.reverse();\r\n   });\r\n\r\n   const tourBounds = L.latLngBounds(locationsArr);\r\n   let map = L.map(\"map\", { closePopupOnClick: false, scrollWheelZoom: false, zoomControl: false }).fitBounds(\r\n      tourBounds,\r\n      {\r\n         padding: [200, 100],\r\n      }\r\n   );\r\n   const mapIcon = L.divIcon({ iconSize: [32, 40], className: \"marker\", iconAnchor: [16, 40], popupAnchor: [0, -25] });\r\n   L.control.zoom().setPosition(\"topright\").addTo(map);\r\n\r\n   locationsArr.forEach((location, idx) => {\r\n      L.marker(location, { icon: mapIcon })\r\n         .addTo(map)\r\n         .bindPopup(L.popup({ autoClose: false, className: \"leaflet-popup--custom\" }))\r\n         .setPopupContent(`Day ${locations[idx].day}: ${locations[idx].description}`)\r\n         .openPopup();\r\n   });\r\n\r\n   L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n   }).addTo(map);\r\n};\r\n","import { showAlert } from \"./alerts\";\r\n\r\nexport const updateSettings = async (data, type) => {\r\n   try {\r\n      const url =\r\n         type === \"data\"\r\n            ? \"http://127.0.0.1:3000/api/v1/users/updateMe\"\r\n            : \"http://127.0.0.1:3000/api/v1/users/updateMyPassword\";\r\n\r\n      const response = await axios.request({\r\n         method: \"PATCH\",\r\n         url: url,\r\n         data: data,\r\n      });\r\n\r\n      if (response.data.status === \"success\") {\r\n         showAlert(\"success\", `${type.toUpperCase()} was updated successfuly`);\r\n      }\r\n   } catch (err) {\r\n      showAlert(\"error\", err.response.data.message);\r\n   }\r\n};\r\n","import { showAlert } from \"./alerts\";\r\n\r\nexport const bookTour = async (tourId) => {\r\n   try {\r\n      const stripe = Stripe(\r\n         \"pk_test_51MbORHGd3fb1GXN5BnDRNDG7GZ8iBCKOMh8oJMpMxHjOnvw95UozlfoY0tEdebwcPiaBrgqJ8EcuPAUq0ye4E7f100lfZ6e1OL\"\r\n      );\r\n      const session = await axios.request({\r\n         method: \"GET\",\r\n         url: `http://127.0.0.1:3000/api/v1/bookings/checkout-session/${tourId}`,\r\n      });\r\n      console.log(\"stripe.bookTour:\", session);\r\n      await stripe.redirectToCheckout({\r\n         sessionId: session.data.session.id,\r\n      });\r\n   } catch (err) {\r\n      console.log(err);\r\n      showAlert(\"error\", err);\r\n   }\r\n};\r\n"],"names":[],"version":3,"file":"bundle.js.map","sourceRoot":"../../"}